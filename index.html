<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jonte – SDXL Showroom</title>
  <style>
    :root { --bg:#0b0b0f; --panel:#121218; --muted:#9aa0a6; --text:#e7e9ea; --border:#1f2430; }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:radial-gradient(1200px 800px at 20% -10%, #111325 0%, transparent 50%),
                 radial-gradient(1000px 700px at 120% 0%, #0e1a19 0%, transparent 40%),
                 var(--bg);
      color:var(--text)
    }
    header{max-width:1200px;margin:24px auto 0;padding:0 20px}
    h1{margin:0 0 6px;font-size:28px;letter-spacing:-.3px}
    .lead{color:var(--muted);font-size:14px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .control{background:var(--panel);border:1px solid var(--border);border-radius:12px;padding:10px 12px;color:var(--text)}
    .control input,.control select{background:transparent;border:none;color:var(--text);outline:none;width:220px}
    main{max-width:1200px;margin:18px auto 60px;padding:0 20px}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
    .thumb{aspect-ratio:4/5;width:100%;object-fit:cover;background:#0d0f12}
    .meta{padding:10px 12px 12px}
    .title{font-weight:700;font-size:15px;margin:2px 0 6px;letter-spacing:.2px}
    .tags{display:flex;gap:6px;flex-wrap:wrap}
    .tag{font-size:11px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#0f121a;color:#cfd3d7}
    .open{margin-top:10px;background:#151a22;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:8px 10px;cursor:pointer}
    .open:hover{border-color:#2a3243}

    /* ===== Modal & dialog ===== */
    dialog{
      width:min(980px,95vw);
      border:none;padding:0;border-radius:16px;overflow:hidden;
      background:var(--panel);color:var(--text)
    }
    dialog::backdrop{background:rgba(0,0,0,.6)}
    dialog[open]{overscroll-behavior:contain}

    .modal{
      display:grid;
      grid-template-columns:1fr 1fr;
      max-height:85vh;          /* viktig: begränsa totalhöjd */
      overflow:hidden;          /* spill göms – scroll sker i .right */
    }
    .modal .left{background:#0b0d12; min-height:0}
    .modal img{width:100%;height:100%;object-fit:contain;background:#0b0d12}

    .modal .right{
      padding:16px 18px;
      border-left:1px solid var(--border);
      max-height:85vh;          /* matcha .modal */
      overflow:auto;            /* egen scroll */
      -webkit-overflow-scrolling:touch;
      min-height:0;
    }

    .row{margin:10px 0}
    .label{font-size:11px;text-transform:uppercase;letter-spacing:.15em;color:var(--muted);margin-bottom:6px}
    .value{white-space:pre-wrap;line-height:1.4}
    .kvs{display:grid;grid-template-columns:140px 1fr;gap:8px 12px;font-size:14px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12.5px}
    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;margin-right:6px;margin-bottom:6px;font-size:12px;background:#0f1218}
    .actions{display:flex;gap:10px;margin-top:12px}
    .btn{background:#1a1f2b;border:1px solid var(--border);color:var(--text);border-radius:10px;padding:8px 10px;cursor:pointer}
    .btn:hover{border-color:#2a3243}
    footer{max-width:1200px;margin:24px auto;padding:0 20px;color:var(--muted);font-size:12px}

    /* Lås bakgrundens scroll när dialog är öppen */
    html.no-scroll, body.no-scroll{
      overflow:hidden !important;
      position:fixed;
      inset:0;
      width:100%;
      height:100%;
    }

    @media(max-width:800px){
      /* Mobil: använd hela höjden till info, göm bilden */
      .modal{grid-template-columns:1fr; max-height:80vh}
      .modal.hide-image .left{display:none !important;}
      .modal.hide-image{grid-template-columns:1fr !important; max-height:85vh;}
      .modal.hide-image .right{
        border-left:none !important;
        border-top:none !important;
        max-height:85vh !important;
      }
      /* Gör knapparna alltid lätta att nå */
      .actions{
        position:sticky;
        bottom:0;
        background:linear-gradient(to top, var(--panel) 60%, rgba(18,18,24,0));
        padding-top:12px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Jonte – SDXL Showroom</h1>
    <div class="lead">
  <p>A curated collection of AI-generated imagery that explores the boundary between realism and surrealism. Nature, portraiture, and dreamlike visions converge in a balance of technical precision and artistic imagination.</p>
  <p>A gallery of AI-generated images with metadata (prompt, checkpoint, LoRA, parameters). All creations are made with Stable Diffusion SDXL using the Automatic1111 interface.</p>
  <p><em>Last update: 2025-08-24</em></p>
</div>
    <div class="controls">
      <div class="control"><input id="search" placeholder="Sök (titel, taggar, prompt)…" /></div>
      <div class="control">
        <select id="tagFilter"><option value="">Filtrera på tagg…</option></select>
      </div>
    </div>
  </header>

  <main>
    <div id="grid" class="grid"></div>
  </main>

  <dialog id="dlg">
    <div class="modal">
      <div class="left"><img id="dlgImg" alt="Bild" loading="lazy" /></div>
      <div class="right">
        <div class="row"><div class="label">Titel</div><div id="dlgTitle" class="value"></div></div>
        <div class="row"><div class="label">Taggar</div><div id="dlgTags" class="value"></div></div>
        <div class="row"><div class="label">Prompt</div><div id="dlgPrompt" class="value mono"></div></div>
        <div class="row"><div class="label">Negativ prompt</div><div id="dlgNPrompt" class="value mono"></div></div>
        <div class="row">
          <div class="label">Teknik</div>
          <div class="kvs value">
            <div>Checkpoint</div><div id="dlgCkpt"></div>
            <div>VAE</div><div id="dlgVae"></div>
            <div>LoRA</div><div id="dlgLoras"></div>
            <div>Sampler</div><div id="dlgSampler"></div>
            <div>Steps</div><div id="dlgSteps"></div>
            <div>CFG</div><div id="dlgCfg"></div>
            <div>Seed</div><div id="dlgSeed" class="mono"></div>
            <div>Resolution</div><div id="dlgRes"></div>
          </div>
        </div>
        <div class="row"><div class="label">Avancerat</div><div id="dlgExtra" class="value kvs"></div></div>
        <div class="row"><div class="label">Kommentar</div><div id="dlgNotes" class="value"></div></div>
        <div class="actions">
          <button class="btn" id="copyMeta">Kopiera metadata</button>
          <button class="btn" id="closeDlg">Stäng</button>
        </div>
      </div>
    </div>
  </dialog>

  <script>
    const grid = document.getElementById('grid');
    const search = document.getElementById('search');
    const tagFilter = document.getElementById('tagFilter');

    const dlg = document.getElementById('dlg');
    const dlgImg = document.getElementById('dlgImg');
    const dlgTitle = document.getElementById('dlgTitle');
    const dlgTags = document.getElementById('dlgTags');
    const dlgPrompt = document.getElementById('dlgPrompt');
    const dlgNPrompt = document.getElementById('dlgNPrompt');
    const dlgCkpt = document.getElementById('dlgCkpt');
    const dlgVae = document.getElementById('dlgVae');
    const dlgLoras = document.getElementById('dlgLoras');
    const dlgSampler = document.getElementById('dlgSampler');
    const dlgSteps = document.getElementById('dlgSteps');
    const dlgCfg = document.getElementById('dlgCfg');
    const dlgSeed = document.getElementById('dlgSeed');
    const dlgRes = document.getElementById('dlgRes');
    const dlgNotes = document.getElementById('dlgNotes');
    const dlgExtra = document.getElementById('dlgExtra');

    function uniq(arr){ return [...new Set(arr.flat().filter(Boolean))]; }
    function normalize(s){ return (s||'').toString().toLowerCase(); }

    function card(g){
      const el = document.createElement('div');
      el.className = 'card';
      el.innerHTML = `
        <img class="thumb" src="${g.file}" alt="${g.title||''}" loading="lazy" />
        <div class="meta">
          <div class="title">${g.title||'Untitled'}</div>
          <div class="tags">${(g.tags||[]).map(t=>`<span class='tag'>${t}</span>`).join('')}</div>
          <button class="open">Visa detaljer</button>
        </div>`;
      el.querySelector('.open').addEventListener('click', ()=> openModal(g));
      return el;
    }

    function lockScroll(on){
      document.documentElement.classList.toggle('no-scroll', on);
      document.body.classList.toggle('no-scroll', on);
    }

    function openModal(g){
      dlgImg.src = g.file; dlgImg.alt = g.title||'';
      dlgTitle.textContent = g.title||'';
      dlgTags.innerHTML = (g.tags||[]).map(t=>`<span class='pill'>${t}</span>`).join('');
      dlgPrompt.textContent = g.prompt||'';
      dlgNPrompt.textContent = g.negative||'';
      dlgCkpt.textContent = g.checkpoint||'';
      dlgVae.textContent = g.VAE || g.vae || '';
      dlgLoras.textContent = (g.loras||[]).join(', ');
      dlgSampler.textContent = g.sampler||'';
      dlgSteps.textContent = (g.steps??'')+'';
      dlgCfg.textContent = (g.cfg??'')+'';
      dlgSeed.textContent = (g.seed??'')+'';
      dlgRes.textContent = g.resolution||'';
      dlgNotes.textContent = g.notes||'';

      const known = new Set(['title','file','tags','prompt','negative','checkpoint','loras','sampler','steps','cfg','seed','resolution','notes','VAE','vae']);
      const extra = Object.entries(g).filter(([k,v])=>!known.has(k) && v!==undefined && v!==null && v!=='');
      dlgExtra.innerHTML = extra.length ? extra.map(([k,v])=>`<div class='mono'>${k}</div><div class='mono'>${v}</div>`).join('') : `<div class='mono'>(tomt)</div><div></div>`;

      // Mobil: dölj bilden helt i detaljvyn
      const modal = dlg.querySelector('.modal');
      if (window.innerWidth <= 800) {
        modal.classList.add('hide-image');
      } else {
        modal.classList.remove('hide-image');
      }

      dlg.showModal();
      lockScroll(true);
    }

    document.getElementById('closeDlg').addEventListener('click', ()=> dlg.close());
    dlg.addEventListener('close', ()=> lockScroll(false));

    // ESC för att stänga
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape' && dlg.open){ dlg.close(); }
    });

    // Stäng när man klickar på backdrop (dvs. utanför .modal-innehållet)
    dlg.addEventListener('click', (e)=>{
      const modal = dlg.querySelector('.modal');
      if (!modal.contains(e.target)) {
        dlg.close();
      }
    });

    document.getElementById('copyMeta').addEventListener('click', ()=>{
      const txt = `Title: ${dlgTitle.textContent}\nTags: ${dlgTags.textContent}\n\nPrompt:\n${dlgPrompt.textContent}\n\nNegative:\n${dlgNPrompt.textContent}\n\nCheckpoint: ${dlgCkpt.textContent}\nVAE: ${dlgVae.textContent}\nLoRA: ${dlgLoras.textContent}\nSampler: ${dlgSampler.textContent}\nSteps: ${dlgSteps.textContent}\nCFG: ${dlgCfg.textContent}\nSeed: ${dlgSeed.textContent}\nResolution: ${dlgRes.textContent}\n\nAdvanced:\n${dlgExtra.textContent}\n\nNotes: ${dlgNotes.textContent}`;
      navigator.clipboard.writeText(txt).then(()=>alert('Metadata kopierad till urklipp.'));
    });

    // === JSON loading & rendering ===
    let DATA = [];
    async function load(){
      try{
        const res = await fetch('gallery.json', {cache:'no-store'});
        if(!res.ok) throw new Error('Kunde inte läsa gallery.json');
        DATA = await res.json();
        buildTagOptions();
        render();
      }catch(err){
        grid.innerHTML = `<div class='control'>Misslyckades att läsa <span class="mono">gallery.json</span>: ${err}</div>`;
      }
    }

    function buildTagOptions(){
      const all = uniq(DATA.map(g=>g.tags||[]));
      for(const t of all){ const opt=document.createElement('option'); opt.value=t; opt.textContent=t; tagFilter.appendChild(opt); }
    }

    function matchesQuery(g,q){
      if(!q) return true;
      const hay=[g.title,...(g.tags||[]),g.prompt,g.negative,g.checkpoint,(g.loras||[]).join(',')].map(v=>String(v||'').toLowerCase()).join('\n');
      return hay.includes(String(q).toLowerCase());
    }
    function matchesTag(g,tag){ if(!tag) return true; return (g.tags||[]).includes(tag); }

    function render(){
      const q = search.value.trim();
      const t = tagFilter.value;
      grid.innerHTML = '';
      DATA.filter(g=>matchesQuery(g,q)&&matchesTag(g,t)).forEach(g=>grid.appendChild(card(g)));
      if(!grid.children.length){
        const empty=document.createElement('div');
        empty.className='control';
        empty.textContent='Inga bilder matchar filtret. Justera sökningen.';
        grid.appendChild(empty);
      }
    }

    search.addEventListener('input', render);
    tagFilter.addEventListener('change', render);

    load();
  </script>
</body>
</html>
